---

# Create registry structure
- name: Create registry data
  ansible.builtin.file:
    path: "{{ app_dir }}/registry/data"
    state: directory
    mode: '0755'
    owner: root
  loop:
    - data

# Copy registry stack
- name: Copy registry stack
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: 0644
  loop:
    - { src: 'files/registry_stack.yml', dest: '{{ app_dir }}/registry/registry_stack.yml' }

# Copy repos to registry
- name: Copy repos to registry
  ansible.builtin.template:
    src: "templates/{{ item }}.j2"
    dest: "{{ app_dir }}/registry/{{ item }}"
    mode: 0755
  loop:
    - apache.j2
    - artifactory.j2
    - bitnami.j2
    - debian.j2
    - gitlab-ee.j2
    - gitlab-runner-helper.j2
    - gitlan-runner.j2
    - httpd.j2
    - nginx.j2
    - postgres.j2
    - rockylinux.j2
    - ubuntu.j2
