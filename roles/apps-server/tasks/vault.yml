---
# Create Vault Directory
- name: Create vault directory
  ansible.builtin.file:
    path: "{{ app_dir }}/vault/{{ item }}"
    state: directory
    mode: 0755
    owner: "{{ app_user }}"
    recurse: yes
  loop:
    - config
    - data
    - logs
    - plugins
    - ssl

- name: Copy cert to vault
  ansible.builtin.copy:
    src: "superasian.net.cert"
    dest: "{{ app_dir }}/vault/ssl/superasian.net.crt"
    mode: 0644
    owner: "{{ app_user }}"

- name: Copy key to vault
  ansible.builtin.copy:
    src: "superasian.net.key"
    dest: "{{ app_dir }}/vault/ssl/superasian.net.key"
    mode: 0600
    owner: "{{ app_user }}"

# Copy vault config
- name: Copy vault config
  ansible.builtin.template:
    src: "templates/{{ item }}.j2"
    dest: "{{ app_dir }}/vault/config/{{ item }}"
    mode: 0644
    owner: "{{ app_user }}"
  loop:
    - vault.hcl